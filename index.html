<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* [Mantengo todos tus estilos CSS originales sin cambios] */
        /* ... (todo tu CSS permanece igual) ... */
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <span>S</span><span>M</span><span>I</span><span>L</span><span>E</span> Chat ðŸ˜Š
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="user-info" id="user-info">
                Â¡Bienvenido al Chat Smile! Ingresa tu nombre para comenzar.
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="username-input" placeholder="Â¿CÃ³mo te llamas?">
            <textarea id="message-input" placeholder="Escribe tu mensaje aquÃ­..." rows="3" disabled></textarea>
            <button id="send-button" disabled>Enviar âœ¨</button>
        </div>
    </div>

    <!-- Firebase SDK v8 (mÃ¡s estable para tu implementaciÃ³n) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // ConfiguraciÃ³n Firebase actualizada
        const firebaseConfig = {
            apiKey: "AIzaSyAH4I4XbzqAph5yq9MUILtu118y5os-oJc",
            authDomain: "smilechat-8afea.firebaseapp.com",
            databaseURL: "https://smilechat-8afea-default-rtdb.firebaseio.com",
            projectId: "smilechat-8afea",
            storageBucket: "smilechat-8afea.firebasestorage.app",
            messagingSenderId: "88368495681",
            appId: "1:88368495681:web:bf70881957a0a819f81ac0",
            measurementId: "G-NKE2WRMT83"
        };

        // InicializaciÃ³n simplificada
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Referencias a elementos del DOM
        const elements = {
            usernameInput: document.getElementById('username-input'),
            messageInput: document.getElementById('message-input'),
            sendButton: document.getElementById('send-button'),
            chatMessages: document.getElementById('chat-messages'),
            userInfo: document.getElementById('user-info')
        };

        // Estado de la aplicaciÃ³n
        let username = '';
        let isTyping = false;
        let typingTimeout;

        // FunciÃ³n para mostrar mensajes (simplificada)
        function displayMessage(data, isCurrentUser = false) {
            const messageType = isCurrentUser ? 'user-message' : 'other-message';
            const time = new Date(data.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${messageType}`;
            messageElement.innerHTML = `
                <div class="message-sender">
                    ${data.sender}
                    <span class="message-time">${time}</span>
                </div>
                <div class="message-content">${data.content}</div>
            `;
            
            elements.chatMessages.appendChild(messageElement);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        // Configurar usuario
        function setUsername() {
            username = elements.usernameInput.value.trim();
            if (username) {
                elements.userInfo.textContent = `Â¡Hola, ${username}!`;
                elements.usernameInput.disabled = true;
                elements.messageInput.disabled = false;
                elements.sendButton.disabled = false;
                elements.messageInput.focus();
                
                // Escuchar nuevos mensajes
                db.ref('messages').orderByChild('timestamp').on('child_added', (snapshot) => {
                    const data = snapshot.val();
                    if (data.sender !== username) {
                        displayMessage(data);
                    }
                });
            }
        }

        // Enviar mensaje
        function sendMessage() {
            const message = elements.messageInput.value.trim();
            if (message && username) {
                const messageObj = {
                    sender: username,
                    content: message,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Mostrar mensaje localmente inmediatamente
                displayMessage(messageObj, true);
                
                // Enviar a Firebase
                db.ref('messages').push(messageObj);
                
                // Limpiar campo
                elements.messageInput.value = '';
            }
        }

        // Event listeners simplificados
        elements.usernameInput.addEventListener('keypress', (e) => e.key === 'Enter' && setUsername());
        elements.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        elements.sendButton.addEventListener('click', sendMessage);
    </script>
</body>
</html>
